# Быстрый старт
YtSync управляет совокупностью динамических таблиц YT на одном или нескольких кластерах YT.

Совокупность таблиц на всех кластерах называется база данных.

## Как работать с YtSync
- создаем экземпляр `YtSync`, указываем какой именно сценарий изменения таблиц нам нужен (про сценарии см. ниже)
- добавляем в него желаемые настройки таблиц/консьюмеров через методы `add_desired_table()`/`add_desired_consumer()`
- из переданных настроек строится желаемая модель базы данных
- запускаем метод `sync()`
- `YtSync` по желаемой модели базы опрашивает реальные таблицы на кластерах (существует ли, схему, атрибуты, и т.п.) и
строит реальную модель базы данных
- `YtSync` запускает выбранный сценарий, в который передается желаемая и актуальная модели базы
- сценарий по двум состояниям базы производит какие-то воздействия на реальные таблицы в YT


## Пример кода
Библиотека YtSync написана на языке программирования Python, поэтому код её использующий тоже должен быть
написан на Python.

Пример есть в [example](https://a.yandex-team.ru/arcadia/yt/yt_sync/example).

Более подробная документация [здесь](usage.md).


## Доступные сценарии {#scenarios}
У сценария есть уникальный строковый идентификатор, которое передается при создании экземпляра `YtSync`.

Сценарии живут в папке [`yt/yt_sync/scenarios`](https://a.yandex-team.ru/arcadia/yt/yt_sync/scenarios).

_Примечание_: если `yt_client_factory` создан с параметром `dry_run=True`, то модифицирующие операции в любом сценарии
будут только залоггированы, но не будут применены, бывает полезно для проверки что ничего криминального не произойдёт.

Более подробное описание сценариев смотри [здесь](scenarios.md).

На данный момент доступны:
- `dump_diff` - пишет в лог отличия между желаемым и реальным состоянием базы данных {#dump-diff-scenario}
- `dump_spec` - просто печатает desired-спеки таблиц
- `clean` - (пере)создает все таблицы базы (если какие-то таблицы существовали, то они будут удалены)
- `ensure_attributes` - синхронизирует только атрибуты таблиц {#ensure-attributes-scenario}
- `ensure` - синхронизирует атрибуты таблиц и изменения схемы, которые можно применить через команду `alter_table`
(свойства колонок, добавление неключевых колонок) {#ensure-scenario}
- `ensure_heavy` - синхронизирует атрибуты таблиц и изменения схемы, при этом для тяжелых изменений схемы вроде
удаления колонки или модификации ключевых колонок таблицы запускаются `map`/`sort` операции, они занимают сильно больше
времени чем простой `alter_table` {#ensure-heavy-scenario}
- `switch_replica` - переключает синхронные реплики таблиц
- `reshard` - решардирует таблицы в соответствии с желаемыми настройками `tablet_count`/`pivot_keys`
- `sync_replicas` - добавить новую реплику с данными для баз с реплицированными таблицами
- `force_compaction` - форсированная компактификация таблиц
- `migrate_to_replicated` - миграция с однокластерной инсталляции в реплицированную
- `migrate_to_chaos` - миграция с реплицированной инсталляции в хаосную
